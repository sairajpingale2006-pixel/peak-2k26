<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peak 2k26</title>

<style>
:root{
  --bg:#0b0b0b;
  --accent:#b30000;
  --accent-dark:#700000;
  --text:#e6e6e6;
  --muted:#777;
}
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #1a1a1a}
h1{margin:0;font-size:18px;letter-spacing:1px}
#coins{color:var(--accent);font-size:14px}
.container{padding:20px;max-width:1000px;margin:auto}
.section-title{margin-top:30px;font-size:13px;letter-spacing:1px;color:var(--muted)}
.ai{border-left:3px solid var(--accent);padding:10px;margin:15px 0;font-size:13px}
.row{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid #1a1a1a}
.row.missed{opacity:.6}
.meta{font-size:12px;color:var(--muted)}
.check{width:22px;height:22px;border:2px solid var(--muted);cursor:pointer}
.check.done{background:var(--accent);border-color:var(--accent)}
.btn{margin-top:15px;font-size:13px;color:var(--accent);cursor:pointer}
.log{font-size:12px;color:var(--muted);margin-top:10px}
</style>
</head>

<body>

<header>
  <h1>PEAK 2K26</h1>
  <div id="coins">Coins: 0</div>
</header>

<div class="container">

  <div id="aiBox"></div>

  <div class="section-title">HABITS</div>
  <div id="habitList"></div>

  <div class="section-title">MEGA ACTIVITIES</div>
  <div id="megaList"></div>

  <div class="section-title">WEEKLY COMPARISON</div>
  <div id="compareBox" class="ai"></div>

  <div class="section-title">FAILURE HEATMAP</div>
  <div id="heatmap"></div>

  <div class="section-title">SPENDING</div>
  <div id="spendLog" class="log"></div>

</div>

<script>
/* =========================
   DATA MODEL
========================= */
const DAY = 24*60*60*1000;
const TODAY = new Date().toDateString();

let data = JSON.parse(localStorage.getItem("peakData")) || {
  coins:0,
  lastDate:TODAY,
  habits:[],
  mega:[],
  spendHistory:[],
  heatmap:{},
  dailyLog:[],      // {date, completed, coins}
  compareHistory:[] // timestamps
};

function save(){localStorage.setItem("peakData",JSON.stringify(data))}

/* =========================
   DAILY RESET + LOG
========================= */
function dailyReset(){
  if(data.lastDate !== TODAY){
    const completed = data.habits.filter(h=>h.done).length;
    data.dailyLog.push({
      date:data.lastDate,
      completed,
      coins:data.coins
    });

    const now=new Date();
    const day=(now.getDay()+6)%7;
    const hour=now.getHours();

    data.habits.forEach(h=>{
      if(!h.done){
        const key=`${day}-${hour}`;
        data.heatmap[key]=(data.heatmap[key]||0)+1;
        h.streak=0;
        h.missed=true;
      }
      h.done=false;
    });

    data.lastDate = TODAY;
  }
}

/* =========================
   WEEKLY COMPARISON
========================= */
function weeklyCompare(){
  if(data.compareHistory.includes(TODAY)) return;

  const last7 = data.dailyLog.slice(-7);
  const prev7 = data.dailyLog.slice(-14,-7);

  if(last7.length < 7 || prev7.length < 7) return;

  const sum = arr => arr.reduce((a,b)=>a+b.completed,0);
  const c1 = sum(last7);
  const c2 = sum(prev7);

  let verdict;
  if(c1 > c2) verdict = "You improved. Barely acceptable.";
  else if(c1 < c2) verdict = "You regressed. Own it.";
  else verdict = "No progress. You stagnated.";

  compareBox.innerHTML =
    `This week: ${c1} actions<br>Last week: ${c2}<br>${verdict}`;

  data.compareHistory.push(TODAY);
}

/* =========================
   HEATMAP
========================= */
function renderHeatmap(){
  heatmap.innerHTML="";
  heatmap.style.display="grid";
  heatmap.style.gridTemplateColumns="repeat(24,1fr)";
  heatmap.style.gap="2px";

  for(let d=0;d<7;d++){
    for(let h=0;h<24;h++){
      const key=`${d}-${h}`;
      const v=data.heatmap[key]||0;
      const lvl=Math.min(v,5);
      const cell=document.createElement("div");
      cell.style.height="14px";
      cell.style.background=[
        "#111","#330000","#550000","#770000","#990000","#b30000"
      ][lvl];
      heatmap.appendChild(cell);
    }
  }
}

/* =========================
   AI (SIMPLE)
========================= */
function runAI(){
  const hour=new Date().getHours();
  const done=data.habits.filter(h=>h.done).length;
  if(done===0 && hour>=21){
    aiBox.innerHTML=`<div class="ai">Today produced nothing.</div>`;
  } else aiBox.innerHTML="";
}

/* =========================
   UI
========================= */
function render(){
  dailyReset();

  habitList.innerHTML="";
  data.habits.forEach((h,i)=>{
    habitList.innerHTML+=`
      <div class="row ${h.missed?"missed":""}">
        <div>${h.name}<div class="meta">${h.streak||0}d</div></div>
        <div class="check ${h.done?"done":""}" onclick="toggleHabit(${i})"></div>
      </div>`;
  });

  megaList.innerHTML="";
  data.mega.forEach(m=>{
    megaList.innerHTML+=`
      <div class="row ${m.done?"missed":""}">
        <div>${m.title}<div class="meta">${m.reward} coins</div></div>
        <div class="check ${m.done?"done":""}"></div>
      </div>`;
  });

  spendLog.innerHTML=data.spendHistory.slice(-5).reverse()
    .map(s=>`âˆ’${s.amount} (${s.reason})`).join("<br>");

  coins.textContent=`Coins: ${data.coins}`;

  runAI();
  weeklyCompare();
  renderHeatmap();
  save();
}

function toggleHabit(i){
  const h=data.habits[i];
  if(h.done)return;
  h.done=true;
  h.missed=false;
  h.streak++;
  data.coins++;
  render();
}

render();
</script>

</body>
</html>
