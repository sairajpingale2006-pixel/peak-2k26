<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peak 2K26</title>

<style>
:root{
  --bg:#0b0b0b;
  --panel:#111;
  --border:#1f1f1f;
  --accent:#b30000;
  --accent-dark:#700000;
  --text:#e6e6e6;
  --muted:#777;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif}
header{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;border-bottom:1px solid var(--border)}
h1{margin:0;font-size:16px;letter-spacing:1px}
#coins{color:var(--accent);font-size:14px}

.tabs{display:flex;border-bottom:1px solid var(--border)}
.tab{padding:12px 16px;cursor:pointer;font-size:13px;color:var(--muted)}
.tab.active{color:var(--accent);border-bottom:2px solid var(--accent)}

.container{padding:20px;max-width:1000px;margin:auto}
.section{display:none}
.section.active{display:block}

.panel{background:var(--panel);border:1px solid var(--border);padding:16px;margin-bottom:16px}

.row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border)}
.row.missed{opacity:.5}
.meta{font-size:12px;color:var(--muted)}

.check{width:22px;height:22px;border:2px solid var(--muted);cursor:pointer}
.check.done{background:var(--accent);border-color:var(--accent)}

.btn{padding:8px 14px;background:var(--accent-dark);border:none;color:#fff;cursor:pointer;font-size:13px}
.btn.secondary{background:#333}

input{width:100%;padding:8px;background:#000;color:#fff;border:1px solid #333;margin-bottom:8px}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.85);
  display:none;align-items:center;justify-content:center
}
.modal .panel{width:320px}
</style>
</head>

<body>

<header>
  <h1>PEAK 2K26</h1>
  <div id="coins">Coins: 0</div>
</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('habits')">Habits</div>
  <div class="tab" onclick="showTab('mega')">Mega</div>
  <div class="tab" onclick="showTab('economy')">Economy</div>
  <div class="tab" onclick="showTab('analytics')">Analytics</div>
  <div class="tab" onclick="showTab('settings')">Settings</div>
</div>

<div class="container">

  <!-- HABITS -->
  <div id="habits" class="section active">
    <div class="panel">
      <div id="habitList"></div>
      <button class="btn" onclick="openHabit()">+ Add Habit</button>
    </div>
  </div>

  <!-- PLACEHOLDERS -->
  <div id="mega" class="section"><div class="panel">Next step</div></div>
  <div id="economy" class="section"><div class="panel">Next step</div></div>
  <div id="analytics" class="section"><div class="panel">Next step</div></div>

  <!-- SETTINGS -->
  <div id="settings" class="section">
    <div class="panel">
      <button class="btn secondary" onclick="logout()">Logout</button>
    </div>
  </div>

</div>

<!-- ADD HABIT MODAL -->
<div class="modal" id="habitModal">
  <div class="panel">
    <input id="habitName" placeholder="Habit name">
    <input id="habitTime" placeholder="Time window">
    <button class="btn" onclick="addHabit()">Add</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCv1tDAxtNMiI2otPWNmnlIgatzR2VxuyU",
  authDomain: "peak-2k26-web.firebaseapp.com",
  projectId: "peak-2k26-web",
  storageBucket: "peak-2k26-web.appspot.com",
  messagingSenderId: "1006854372406",
  appId: "1:1006854372406:web:3acb7885e6dddc8065ac97"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let userRef, data;
const TODAY = new Date().toDateString();

/* ===== AUTH ===== */
auth.onAuthStateChanged(async user=>{
  if(!user){ location.reload(); return; }
  userRef = db.collection("users").doc(user.uid);
  const snap = await userRef.get();
  data = snap.data();
  dailyReset();
  render();
});

/* ===== TABS ===== */
function showTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  event.target.classList.add("active");
  document.getElementById(id).classList.add("active");
}

/* ===== HABITS ===== */
function openHabit(){ habitModal.style.display="flex" }

async function addHabit(){
  if(!habitName.value.trim())return;
  data.habits.push({
    name:habitName.value,
    time:habitTime.value,
    streak:0,
    done:false,
    missed:false
  });
  habitName.value=habitTime.value="";
  habitModal.style.display="none";
  await save();
  render();
}

async function toggleHabit(i){
  const h=data.habits[i];
  if(h.done)return;
  h.done=true;
  h.missed=false;
  h.streak++;
  data.coins++;
  await save();
  render();
}

/* ===== DAILY RESET ===== */
function dailyReset(){
  if(data.lastDate !== TODAY){
    data.habits.forEach(h=>{
      if(!h.done){
        h.streak=0;
        h.missed=true;
      }
      h.done=false;
    });
    data.lastDate = TODAY;
    save();
  }
}

/* ===== SAVE ===== */
async function save(){
  await userRef.update({
    habits:data.habits,
    coins:data.coins,
    lastDate:data.lastDate
  });
}

/* ===== RENDER ===== */
function render(){
  coins.textContent="Coins: "+data.coins;
  habitList.innerHTML="";
  data.habits.forEach((h,i)=>{
    habitList.innerHTML+=`
      <div class="row ${h.missed?"missed":""}">
        <div>${h.name}<div class="meta">${h.time} Â· ${h.streak}d</div></div>
        <div class="check ${h.done?"done":""}" onclick="toggleHabit(${i})"></div>
      </div>`;
  });
}

/* ===== LOGOUT ===== */
function logout(){ auth.signOut(); }
</script>

</body>
</html>
